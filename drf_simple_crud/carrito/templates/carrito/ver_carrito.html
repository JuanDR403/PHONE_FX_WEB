{% extends 'base.html' %}
{% load static %}

{% block title %}Mi Carrito{% endblock %}

{% block content %}
<div class="container py-4">
  <h1 class="mb-4">Mi Carrito</h1>

  {% if items %}
    <div class="table-responsive">
      <table class="table align-middle">
        <thead>
          <tr>
            <th>Producto</th>
            <th class="text-center">Cantidad</th>
            <th class="text-end">Precio unitario</th>
            <th class="text-end">Total</th>
            <th class="text-end">Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for item in items %}
          <tr>
            <td>
              {% if item.producto and item.producto.imagen %}
                <img src="{{ item.producto.imagen }}" alt="{{ item.nombre }}" style="width:48px;height:48px;object-fit:cover;border-radius:6px;" class="me-2">
              {% endif %}
              {{ item.nombre }}
            </td>
            <td class="text-center">
              <div class="d-inline-flex align-items-center gap-2">
                <form method="post" action="{% url 'carrito:decrementar_cantidad' %}" class="d-inline">
                  {% csrf_token %}
                  <input type="hidden" name="detalle_id" value="{{ item.idcarritodetalle }}">
                  <button type="submit" class="btn btn-sm btn-outline-secondary" title="Restar uno">-</button>
                </form>
                <span class="mx-2">{{ item.cantidad }}</span>
                <form method="post" action="{% url 'carrito:incrementar_cantidad' %}" class="d-inline">
                  {% csrf_token %}
                  <input type="hidden" name="detalle_id" value="{{ item.idcarritodetalle }}">
                  <button type="submit" class="btn btn-sm btn-outline-secondary" title="Sumar uno">+</button>
                </form>
              </div>
            </td>
            <td class="text-end">$ {{ item.precio_unit_str }}</td>
            <td class="text-end fw-semibold">$ {{ item.total_linea_str }}</td>
            <td class="text-end">
              <form method="post" action="{% url 'carrito:eliminar_del_carrito' %}" onsubmit="return confirm('¿Eliminar este producto del carrito?');">
                {% csrf_token %}
                <input type="hidden" name="detalle_id" value="{{ item.idcarritodetalle }}">
                <button type="submit" class="btn btn-sm btn-outline-danger">Eliminar</button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
        <tfoot>
          <tr>
            <th colspan="3" class="text-end">Subtotal</th>
            <th class="text-end">$ {{ subtotal_str }}</th>
          </tr>
          <tr>
            <th colspan="3" class="text-end">Total</th>
            <th class="text-end">$ {{ subtotal_str }}</th>
          </tr>
        </tfoot>
      </table>
    </div>
  {% else %}
    <div class="alert alert-info" role="alert">
      Tu carrito está vacío. Visita la <a href="{% url 'tienda:lista_productos' %}">tienda</a> para agregar productos.
    </div>
  {% endif %}
</div>
{% endblock %}
